<div id="contents">
    <!-- search bar -->
    <div class="col-md-3">
        <div id="search">
          <%= form_tag root_path, :method => "get", :id => 'search-bar' do %>
            <%= text_field_tag :search, params[:search] %>
            <%= submit_tag "Search", :name => nil %>
            <div class="clear"></div>
            <label for='choice'>Search by:</label>
            <%= radio_button_tag 'choice', 'author', params[:choice] == 'author' || params[:choice] == nil %>
            <%= 'Author'.humanize %>
            <%= radio_button_tag 'choice', 'keyword', params[:choice] == 'keyword' %>
            <%= 'Keywords'.humanize %>
          <% end %>
        </div>

        <hr>
        <!-- date tree -->
        <div id='date_tree'>
        <b>Browse by Issue:</b>
            <table cellspacing="0" rules="all" border="1" id="IssueGridView">
                <tbody>
                    <% for decade in @decades%>
                        <tr>
                            <td>
                            <!-- take current params, add decade to it, and create a url for the new query  -->
                                <%= link_to(decade.to_s + 's', url_for(params.merge(:decade => decade.to_s)), class: "decade_link") %>
                            </td>
                            <% if params[:decade] != nil && params[:decade] == decade.to_s %>
                                <% for year in @years %>
                                    <tr>
                                        <td>
                                            <%= link_to(year.to_s, url_for(params.merge(:year => year.to_s)), class: "year_link") %>
                                        </td>
                                    </tr>
                                    <% if params[:year] != nil && params[:year] == year.to_s %>
                                        <% for issue in @issues %>
                                            <tr>
                                                <td>
                                                    <%= link_to("Vol. " + issue['Volume'].to_s + ", No. " + issue['Issue'].to_s + ", " + issue['Season'].to_s, url_for(params.merge(:issue_id => issue['ID'].to_s)), class: "issue_link") %>
                                                </td>
                                            </tr>
                                        <% end %>
                                    <% end %>
                                <% end %>
                            <% end %>
                        </tr>
                    <% end %>
                </tbody>
            </table>
        </div>
    </div>
    <!-- results -->
    <div class="col-md-9">
        <div id="issue_panel">
            <% if params.key?(:issue_id) %>
                <h3>
                    <%= "Vol. " + @issue['Volume'].to_s + ", No. " + @issue['Issue'].to_s + ", " + @issue['Season'].to_s + " " + @issue['Year'].to_s %>
                </h3>
            <% elsif params.key?(:search) %>
                <%= @results_length %> total search results for "<%= params[:search] %>". <%= link_to "clear search", root_path %>
            <% end %>
            <% if @articles != nil && (params.key?(:search) || params.key?(:issue_id)) %>
                <% @articles.each do |article| %>
                    <%= generate_issue_info(article) %>
                    <p class="metadata">
                        <%= generate_title(article) %>
                        <%= generate_author(article) %>
                        <%= generate_page_nums(article) %>
                        <%= generate_genres(article) %>
                        <%= generate_reviews(article) %>
                        <%= generate_notes(article)%>
                    </p>
                    <hr>
                <% end %>
            <%= will_paginate @articles %>
            <% end %>
        </div>
    </div>
</div>
